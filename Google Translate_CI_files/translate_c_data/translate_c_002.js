(function(){define("lib/m",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document;return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isSF:/a/.__proto__=="//",isCR:/s/.test(/a/.toString)},scriptOnload:function(e,t){this.ua.isIE?e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()}):(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1))},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})}}}),define("lib/JSON2",function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}window.JSON||(window.JSON={}),typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),define("lib/JSON2",function(){}),define("lib/store",["lib/JSON2"],function(){function e(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),"localStorage"in window}catch(n){return!1}}var t=e(),n={set:function(){},get:function(){},remove:function(){},clear:function(){},isSupport:!1};if(t){var r=window.localStorage,i=function(e,t){var n=r[e];return function(i){setTimeout(function(){i=i||window.storageEvent;var s=i.key,o=i.newValue;if(!s){var u=r[e];u!=n&&(s=e,o=u)}s==e&&(t&&t(o==null?null:JSON.parse(o)),n=o)},0)}};n.set=function(e,t){r.setItem(e,JSON.stringify(t))},n.get=function(e){var t=r.getItem(e),i=t==null?null:JSON.parse(t);return i!==null&&i.date&&i.expiredDate&&n._expired(e,i.expiredDate,i.date)&&(i=null),i},n.remove=function(e){r.removeItem(e)},n.clear=function(){r.clear()},n.onStorage=function(e,t){window.addEventListener?window.addEventListener("storage",i(e,t),!1):document.attachEvent("storage",i(e,t))},n._expired=function(e,t,r){return(new Date).getTime()-r>=t*864e5?(n.remove(e),!0):!1},n.isSupport=!0}else/MSIE ([^;]+)/.test(navigator.userAgent)&&(n={o:null,defExps:365,init:function(){if(!n.o)try{n.o=document.createElement("input"),n.o.type="hidden",n.o.addBehavior("#default#userData"),document.body.appendChild(n.o)}catch(e){return!1}return!0},set:function(e,t,r){if(n.init()){var i=n.o;i.load(e),t&&i.setAttribute("code",JSON.stringify(t));var s=new Date,r=r?r:n.defExps;s.setDate(s.getDate()+r),i.expires=s.toUTCString(),i.save(e)}},get:function(e){if(n.init()){var t=n.o;return t.load(e),typeof t.getAttribute("code")=="undefined"?null:JSON.parse(t.getAttribute("code"))}},onStorage:function(){},remove:function(e){n.set(e,!1,-365)},isSupport:!0});return n}),define("lib/user",["lib/store"],function(e){function n(n,i){if(!window.ukey)return n(null);var s=r();!s||window.ukey!=s.ukey?$.getJSON("/_csi/user/info.json").done(function(r){r.ok&&(e.isSupport&&e.set(t,r.result),n(r.result))}).fail(function(){i&i()}):n(s)}function r(){e.get(t)}function i(){e.remove(t)}var t="CURRENT_USER_CACHE_KEY";return{getCurrent:n,getUserCache:r,clearUserCache:i,isLogin:function(){return typeof ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),define("lib/bdShare",[],function(){var e='分享到：                            <a data-cmd="douban" class="share-db" href="#" title="分享到豆瓣">豆瓣</a>                            <a data-cmd="tsina" class="share-sina" href="#" title="分享到新浪微博">新浪微博</a>                            <a data-cmd="qzone" class="share-qzone" href="#" title="分享到QQ空间">QQ空间</a>                            <a data-cmd="weixin" class="share-wx" href="#" title="分享到微信">微信</a>                            <a data-cmd="tqq" class="share-qqmb" href="#" title="分享到腾讯微博">腾讯微博</a>                            <div class="counter"><b><s></s></b><span class="bds_count share_counter" data-cmd="count"></span></div>',t;return function(n,r){t=$(n);var i=r||e;t.html(i)}}),define("lib/support",["lib/m"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/jquery/easing",[],function(){jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}})}),define("lib/scrollTo",["lib/jquery/easing"],function(e){"use strict";function n(e){var t=window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,n=window.scrollY||window.pageYOffset||document.documentElement.scrollTop,r=n+(window.innerHeight||document.documentElement.clientHeight),i=t+(window.innerWidth||document.documentElement.clientWidth),s=e.scrollLeft,o=e.scrollTop,u=s+(e.width||0),a=o+(e.height||0),f=!1,l=!1;if(s!=null&&s<t||u>i)f=!0;if(o!=null&&o<n||a>r)l=!0;return f&&l?3:l?2:f?1:0}var t=$("html,body");return function(e,r,i,s,o){function p(){t.animate(f,c||1e3,"easeInOutCirc",i?function e(){e.exed&&i(),e.exed=!0}:null)}var u=typeof e=="number",a=u?{top:e,left:e}:e.offset?e.offset():e,f={},l,c,h;typeof s=="number"?(c=s,h=typeof o=="string"?o:"top"):typeof s=="string"?(c=1e3,h=s):(c=1e3,h=u?"top":"all");switch(h){case"all":f.scrollTop=a.top,f.scrollLeft=a.left;break;case"top":f.scrollTop=a.top;break;case"left":f.scrollLeft=a.left;break;default:return}e.jquery&&(f.width=e.width(),f.height=e.height()),l=n(f),e.jquery&&(delete f.width,delete f.height);if(r)return p(),!0;switch(l){case 0:return i&&i(),!1;case 1:return delete f.scrollTop,p(),!0;case 2:return delete f.scrollLeft,p(),!0;case 3:return p(),!0;default:}}}),define("lib/screenTop",["lib/support","lib/scrollTo"],function(e,t){"use strict";function a(){var t=s.height();if(o>t*1){e.fixed()||n.css("top",o+t-u);if(i)return;r||(n.appendTo("body"),u+=n.outerHeight(),r=!0),n.show(),i=!0}else i&&(n.hide(),i=!1)}var n=$('<a class="screen-top" href="#"><s></s><b></b>返回顶部</a>'),r=!1,i=!1,s=$(window),o,u;return e.fixed()||n.css("bottom","auto"),function(r){e.fixed()||(u=r||80),s.scroll(function(){o=s.scrollTop(),setTimeout(a)}),o=s.scrollTop(),n.click(function(e){e.preventDefault(),t(0)}),a()}}),function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}(),define("Base64",function(){}),function(e){"use strict";function a(e){var t=0,n;for(n=0;n<e.length;n++)t=e.charCodeAt(n)+(t<<6)+(t<<16)-t<<0;return t}function f(){return e.devicePixelRatio||1}function l(e,t,n,r){var i,s,o,u="",f=e.length;t=t.replace(/^\/+/,""),f>1?(s=a(t)%f,s<0&&(s+=3),o=e[s]):o=e[0],i="http://"+o+"/"+encodeURI(t);if(n&&r)u+="/1";else if(n||r)u+="/3";return n&&(u+="/w/"+n),r&&(u+="/h/"+r),u!==""&&(i=i+"?imageView2"+u),i}function c(e){return e.indexOf("dev.guokr.com")>0}function h(e,t,n){var s,a,f,h,p=r.createElement("a"),d=c(e)?o:u;p.href=e,h=p.pathname;if(h.indexOf("/image/")===0)h=h.slice(7);else if(h.indexOf("image/")===0)h=h.slice(6);else if(h.indexOf("/thumbnail/")===0||h.indexOf("thumbnail/")===0)f=e.replace(i,"$2"),s=f.slice(-2),a={dJ:".gif",pQ:".jpg",BO:".png"}[s],h=f+a;return l(d,h,t,n)}function p(e,t,r){var o={src:e,width:null,height:null,"data-hashkey":null,"data-orig-width":null,"data-orig-height":null};if(!i.test(e))return s.test(e)&&(o.src=h(e)),o;o.src=e=h(e);var u=f(),a=e.replace(i,"$2"),l=n(a.replace(/_/g,"/").replace(/-/g,"+")),c=l.charCodeAt(32)+l.charCodeAt(33)*256+l.charCodeAt(34)*65536+l.charCodeAt(35)*16777216,p=l.charCodeAt(36)+l.charCodeAt(37)*256+l.charCodeAt(38)*65536+l.charCodeAt(39)*16777216;o["data-hashkey"]=a,o["data-orig-width"]=c,o["data-orig-height"]=p;if(t===undefined&&r>0)t=r*c/p;else if(r===undefined&&t>0)r=t*p/c;else if(t<1||r<1)return o;if(c<t*u||p<r*u)u=1,c>t&&p>r?u=Math.min(c/t,p/r):(t=c>t?t:c,r=p>r?r:p);o.width=Math.round(t),o.height=Math.round(r),t=Math.round(t*u),r=Math.round(r*u);if(Math.abs(c-t)>1||Math.abs(p-r)>1)o.src=h(e,t,r);return o}function d(e){if(i.test(e)||s.test(e))e=h(e);return e}var t,n=e.atob||require("Base64").atob,r=e.document||require("jsdom").jsdom(),i=/^http:\/\/(img1\.(?:\w+\.)?guokr\.com(?:\:\d+)?\/(?:image|thumbnail)|\d+\.im(?:\.dev)?\.guokr\.com(?:\:\d+)?)\/([\w-]{56})(?:_\d*x\d*)?\.(jpg|png|gif)(\?.*|$)/,s=/^(http:\/\/(?:\w+\.)*guokr\.com(?:\:\d+)?)?(\/gkimage\/[a-z0-9\/]{15}\.(gif|jpe?g|png))(\?.*|$)/,o=["1.im.dev.guokr.com","2.im.dev.guokr.com","3.im.dev.guokr.com"],u=["1.im.guokr.com","2.im.guokr.com","3.im.guokr.com"];t={sdbm:a,thumbnail:p,original:d,public_url:h},typeof define=="function"&&define.amd?define("lib/gkimage",["Base64"],function(){return t}):typeof e!="undefined"?(typeof module!="undefined"&&module.exports&&(e=module.exports=t),e.gkimage=t):window.gkimage=t}(typeof exports=="object"&&exports||this),define("lib/gbbcode",["jquery","lib/gkimage"],function(t,n){"use strict";function u(e){return/www\.tudou\.com/.test(e)?e+="&autoPlay=true":/www\.56\.com/.test(e)?e+="?auto=1":/player\.video\.qiyi\.com/.test(e)&&(e+="-autoPlay=1"),e}function a(e){var r=/src="[^"]+"/;e.each(function(){var e,r,i,s,o,u=t(this),a=u.parents(".gbbcode-content"),f=u.data("image"),l=t("<img>");u.replaceWith(l),i=l.css("max-width"),i!==null&&i.slice(-2)==="px"?i=parseInt(i):i=a.width(),s=i,o=l.parent(),o.css("display")==="block"&&(s=o.width()||s),r=Math.min(i,s),e=n.thumbnail(f,r),e.width===null?l.attr("src",e.src):l.attr(e)})}function f(e){e.each(function(){var e=t(this);e.attr("src",e.attr("src").replace(/\.svg$/,".png"))})}function l(e,r){var s=[];e.each(function(){var e=t(this).data("video-loaded"),n=t(this).data("video");e!==!0&&s.indexOf(n)<0&&s.push(n)});if(s.length===0)return;t.ajax({url:"/apis/shortener/url.json",type:"post",data:{url:s},dataType:"json",traditional:!0,success:function(o){if(!o.ok)return;s=[],e.each(function(){var e=t(this),r=e.parents(".gbbcode-content"),s=e.data("video"),a=o.result[s].extradata,f=o.result[s].urltype,l=e.width(),c=e.height();if(!a||a.player_type===undefined)return;var h,p,d=a.preview_image,v=u(a.player_url),m=a.player_type,g=a.title+" - "+f.title,y=n.thumbnail(d,l,c);e.attr("title",g).css("background-image","url("+y.src+")").bind("click touch",function(n){var s,o;if(m==="flash"&&i===!1){e.attr("target","_blank");return}n.preventDefault(),e.css("display","none"),p===undefined?p=t('<a data-collapsed href="javascript: void(0)">↑ 收起</a>').data("collapsed",!1).insertAfter(e).bind("click touch",function(t){t.preventDefault();if(p.data("collapsed")===!0)return;h.remove(),h=undefined,e.css("display","block"),p.css("display","none").data("collapsed",!0)}):p.css("display","block").data("collapsed",!1);if(h!==undefined)return;h=t("<iframe>").attr({src:v,frameborder:0,allowfullscreen:!0}).insertAfter(e),o=h.css("max-width"),o!==null&&o.slice(-2)==="px"?o=parseInt(o):o=r.width(),s=Math.min(o,h.parent().width()||o),h.attr({width:s,height:s*9/12})}).data("video-loaded",!0)}),r instanceof Function&&r()}})}function c(e){e.each(function(){var e=t(this);e.bind("load",function(){e.height(e.contents().find("body").height()+50)}),e.height(e.contents().find("body").height()+50)})}var r=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1"),i=!1;try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");s&&(i=!0)}catch(o){navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(i=!0)}return function(e){e===undefined&&(e={}),e.imageSelector=e.imageSelector||"noscript[data-image]",e.videoSelector=e.videoSelector||"a[data-video]",e.mathSelector=e.mathSelector||"img[data-math]",e.pollSelector=e.pollSelector||"iframe[data-poll]",a(t(e.imageSelector)),l(t(e.videoSelector)),c(t(e.pollSelector)),r!==!0&&f(t(e.mathSelector))}}),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Menu",["lib/tmpl","lib/Event"],function(e,t){"use strict";function r(t,r,i,s){$.isFunction(i)||(s=i,i=null),this.$menu=$(e(n,{list:r,useFocus:s.useFocus,convert:s.convert,className:s.className||""})),this.$list=this.$menu.find("li"),this.selected=-1,this.data=r,this.doneCallBack=i;var o=this;o.$menu.appendTo(t).delegate("li","mouseenter",function(){var e=o.$list.index(this);if(o.selected===e)return;o.select(e,s.disableMouseChangeEvent)}).delegate("li","click",function(){var e=o.$list.index(this);o.selected=e,o.done()}).mouseleave(function(){o.select(-1,s.disableMouseChangeEvent)});if(s.useFocus){var u=o.$menu.children("a");u.keydown(function(e){e.preventDefault();switch(e.which){case 13:o.done();break;case 27:o.hide();break;case 40:o.down();break;case 38:o.up()}}).focus(function(){o.show(),o.selected===-1&&o.select(0)}),this.focus=function(){return u.focus(),this}}}var n='<div class="gui-menu <%=className%>">                        <% if (useFocus) { %>                            <a href="#" tabindex="0" hidefocus="true" class="gui-menu-focus">&nbsp;</a>                        <% } %>                        <ul class="gui-menu-list">                            <% for (var i=0;i<list.length;i++) { %>                            <li>                                <% if (typeof convert !== "undefined") { %>                                    <%:=convert(list[i])%>                                <% } else { %>                                    <%=list[i]%>                                <% } %>                            </li>                            <% } %>                        </ul>                    </div>';return t.extend(r),r.prototype.up=function(){var e=this.selected-1;return e<0&&(e=this.data.length-1),this.select(e),this},r.prototype.down=function(){var e=this.selected+1;return e>this.data.length-1&&(e=0),this.select(e),this},r.prototype.select=function(e,t){if(e==null)return this.data[this.selected];if(e<-1||e>=this.data.length)e=-1;return!t&&this.selected!==e&&!this.fire("change",this.data[e])?this:(this.selected=e,this.$list.removeClass("selected"),this.selected!==-1&&$(this.$list[this.selected]).addClass("selected"),this)},r.prototype.remove=function(){if(!this.fire("remove"))return;this.$menu&&this.$menu.remove(),delete this.$menu,delete this.$list,delete this.selected,delete this.data,delete this.doneCallBack},r.prototype.show=function(){return this.$menu.show(),this},r.prototype.hide=function(){return this.fire("hide")?(this.$menu.hide(),this):this},r.prototype.onChange=function(e){return this.on("change",e,this),this},r.prototype.onRemove=function(e){return this.on("remove",e,this),this},r.prototype.onHide=function(e){return this.on("hide",e,this),this},r.prototype.done=function(){return this.doneCallBack&&this.doneCallBack.call(this,this.data[this.selected]),this},r}),define("lib/Trie",[],function(){"use strict";function t(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)e[r].indexOf(t)!==-1&&n.push(e[r]);return n}function n(e){var t=[],n={},r;for(var i=0,s=e.length;i<s;i++)r=e[i],n[r]||(t.push(r),n[r]=!0);return t}function r(r,i,s,o){function a(n,r,s){if(n.length===0){f(s,e-r);return}var o;(o=s[n.slice(0,1)])?(o.$&&n.length===1&&(u=u.concat(o.$)),a(n.slice(1),r,o)):s.$&&(u=u.concat(t(s.$,i)))}function f(e,t){if(t===0)return;var n;for(var r in e)n=e[r],n.$&&(u=u.concat(n.$)),f(n,t-1)}var u=[];i=new String(i),o&&(i=o(i)),a(i,i.length,r),s(n(u))}function i(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(toString.call(e))[1].toLowerCase():typeof e}var e=5;return function(t,n,s){var o,u=!1,a=!1,f,l,c="";typeof g_obj_id!="undefined"&&(c=g_obj_id),i(t)==="function"?u||(u=!0,t(e,c,function(e){u=!1,o=s?s(e):e,f&&l&&r(o,f,l,n)},function(){a=!0,u=!1,s&&s()})):o=t,this.calculate=function(e,t){if(!e||a){t();return}u?(f=e,l=t):r(o,e,t,n)},this.isLoading=function(){return u},this.isFailed=function(){return a}}}),define("lib/cookies",{get:function(e){"use strict";if(document.cookie.length>0){var t,n=document.cookie.indexOf(e+"=");if(n!=-1)return n=n+e.length+1,t=document.cookie.indexOf(";",n),t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))}return""},set:function(e,t,n,r){"use strict";return document.cookie=e+"="+escape(t)+(n==null?"":";expires="+n.toGMTString())+";path="+(r||"/"),this},remove:function(e,t){"use strict";var n=new Date;n.setTime(n.getTime()-1);var r=this.get(e);r!=null&&(document.cookie=e+"="+r+";expires="+n.toGMTString()+";path="+(t||"/"))}}),define("lib/accessToken",["lib/cookies"],function(e){"use strict";var t,n=window.location.host,r=window.url_re_signin||"",i=window.client_id||32353;return t=e.get("_"+i+"_access_token"),{checkToken:function(){return typeof t=="string"?!0:!1},getToken:function(){return t}}}),define("lib/TextUtils",[],function(){"use strict";function c(e,t){var n=typeof e[t];return n==="function"||n=="object"&&!!e[t]||n=="unknown"}function h(t,n){return typeof t[n]!=e}function p(e,t){return typeof e[t]=="object"&&!!e[t]}function d(e){window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: "+e)}function v(t,n,r){return n<0&&(n+=t.value.length),typeof r==e&&(r=n),r<0&&(r+=t.value.length),{start:n,end:r}}function m(e,t,n){return{start:t,end:n,length:n-t,text:e.value.slice(t,n)}}function g(){return p(document,"body")?document.body:document.getElementsByTagName("body")[0]}function w(e,t){return function(){var n=this.jquery?this[0]:this,r=n.nodeName.toLowerCase();if(n.nodeType==1&&(r=="textarea"||r=="input"&&n.type=="text")){var i=[n].concat(Array.prototype.slice.call(arguments)),s=e.apply(this,i);if(!t)return s}if(t)return this}}var e="undefined",t,n,r,i,s,o,u,a,f,l,y=document.createElement("textarea");g().appendChild(y);if(h(y,"selectionStart")&&h(y,"selectionEnd")&&c(y,"setSelectionRange"))t=function(e){var t=e.selectionStart,n=e.selectionEnd;return m(e,t,n)},n=function(e,t,n){var r=v(e,t,n);e.focus(),e.setSelectionRange(r.start,r.end)},f=function(e,t){t?e.selectionEnd=e.selectionStart:e.selectionStart=e.selectionEnd};else{if(!(c(y,"createTextRange")&&p(document,"selection")&&c(document.selection,"createRange"))){g().removeChild(y),d("No means of finding text input caret position");return}t=function(e){e.focus();var t=0,n=0,r,i,s,o,u=document.selection.createRange();return u&&u.parentElement()==e&&(s=e.value.length,r=e.value.replace(/\r\n/g,"\n"),i=e.createTextRange(),i.moveToBookmark(u.getBookmark()),o=e.createTextRange(),o.collapse(!1),i.compareEndPoints("StartToEnd",o)>-1?t=n=s:(t=-i.moveStart("character",-s),t+=r.slice(0,t).split("\n").length-1,i.compareEndPoints("EndToEnd",o)>-1?n=s:(n=-i.moveEnd("character",-s),n+=r.slice(0,n).split("\n").length-1))),m(e,t,n)};var b=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};n=function(e,t,n){var r=v(e,t,n),i=e.createTextRange(),s=b(e,r.start);i.collapse(!0),r.start==r.end?i.move("character",s):(i.moveEnd("character",b(e,r.end)),i.moveStart("character",s)),i.select()},f=function(e,t){var n=document.selection.createRange();n.collapse(t),n.select()}}g().removeChild(y),i=function(e,t,r,i){var s;t!=r&&(s=e.value,e.value=s.slice(0,t)+s.slice(r)),i&&n(e,t,t)},r=function(e){var n=t(e);i(e,n.start,n.end,!0)},a=function(e){var r=t(e),i;return r.start!=r.end&&(i=e.value,e.value=i.slice(0,r.start)+i.slice(r.end)),n(e,r.start,r.start),r.text},l=function(e,t){t==null&&(t=e.value.length),n(e,t,t)},s=function(e,t,r,i){var s=e.value,o;e.value=s.slice(0,r)+t+s.slice(r),i&&(o=r+t.length,n(e,o,o))},o=function(e,r){var i=t(e),s=e.value;e.value=s.slice(0,i.start)+r+s.slice(i.end);var o=i.start+r.length;n(e,o,o)},u=function(e,r,i){var s=t(e),o=e.value;e.value=o.slice(0,s.start)+r+s.text+i+o.slice(s.end);var u=s.start+r.length,a=u+s.length;n(e,u,a)},$.fn.extend({getSelection:w(t,!1),setSelection:w(n,!0),collapseSelection:w(f,!0),deleteSelectedText:w(r,!0),deleteText:w(i,!0),extractSelectedText:w(a,!1),insertText:w(s,!0),replaceSelectedText:w(o,!0),surroundSelectedText:w(u,!0),insertCaret:w(l,!0)})}),define("lib/at",["lib/tmpl","lib/Menu","lib/Trie","lib/accessToken","lib/TextUtils"],function(e,t,n,r,i){"use strict";function S(e){!$.contains(l[0],e.target)&&c[0]!==e.target&&C()}function x(e,t,n,r){$.ajax({type:"get",url:"/apis/community/relationship/following_nickname.json",data:{access_token:w},success:function(e){e.ok&&n(e.result)},error:r,dataType:"json"})}function T(){if(T.inited)return;f=$("body"),l=$(s).appendTo(f),c?l.css("marginTop","30px"):c=l.prepend(o).find("input"),h=l.children("div"),g=new n(x,function(e){return e.toLowerCase().replace(b,"")},function(t){return h.html(e(u,{tip:t==null?null:E.tip,noneTip:t==null?E.loadFailTip:null})),m&&m.remove(),t});var t=!1;c.keydown(function(e){switch(e.which){case 13:e.preventDefault(),C(c.val()),t=!1;break;case 27:e.preventDefault(),C(),t=!1;break;case 40:m&&(t=!0,e.preventDefault(),m.down());break;case 38:m&&(t=!0,e.preventDefault(),m.up());break;case 8:c.val().length===0&&(e.preventDefault(),C()),t=!1;break;default:setTimeout(function(){var e=c.val();e&&e.slice(e.length-1).match(y)&&(e=e.replace(y,""),C(e))}),t=!1}}),window.addEventListener?c[0].addEventListener("input",function(){N(c.val())},!1):window.attachEvent&&c[0].attachEvent("onpropertychange",function(){!t&&window.event.propertyName=="value"&&N(c.val())}),T.inited=!0}function N(n){var r=null,i=null;g.calculate(n,function(n){g.isFailed()?r=E.loadFailTip:g.isLoading()?i=E.loadingTip:n==null?i=E.tip:n.length===0&&(r=E.noneTip),h.html(e(u,{tip:i,noneTip:r})),m&&m.remove(),n&&n.length>0&&(n=n.slice(0,10),m=(new t(h,n,function(e){C(e)},{useFocus:!0,disableMouseChangeEvent:!0})).onChange(function(e){c.val(e)}).onHide(function(){c.insertCaret()}))})}function C(e){e==="妹子"&&alert("﹁_﹁，出门右转是性情！"),l.css("left",-99999),e?p(e+" "):d(),f.unbind("click",S),a&&a.unbind("click",S),v=!1}var s='<div class="gui-at"><div></div></div>',o='<input class="gbtxt"/>',u='<% if(tip) { %><p><%=tip%></p><% } %><% if (noneTip) { %><p class="gui-at-none"><%=noneTip%></p><% } %>',a,f,l,c,h,p,d,v=!1,m,g,y=/[^\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9._\-]/g,b=/[^\u3400-\u4db5\u4e00-\u9fcba-z0-9]/g,w=r.getToken(),E={tip:"输入对方昵称来@TA",loadFailTip:"获取失败，请刷新页面重试",loadingTip:"获取用户列表中...",noneTip:"关注列表无匹配，回车键确认输入"};return function(t,n,r,i,s){if(v)return;v=!0,p=n,d=r,i&&(a=i),s&&(c=s),setTimeout(function(){T(),l.css({top:t.top,left:t.left,display:"block"}),s||c.val(""),N(c.val()),f.click(S),a&&a.click(S)})}}),define("academyApi",["lib/accessToken"],function(e){function i(e,t,n,i,s){var o=s===0?"discussion_id":"id";data={opinion:t,access_token:r},data[o]=e,$.ajax({url:i,data:data,type:"POST",success:function(e){e.ok&&n&&n()},dataType:"json"})}function s(e,r,s){return i(e,r,s,t.community_post_recommend,n.community)}function o(e,r,s){return i(e,r,s,t.course_post_recommend,n.course)}function u(e,t,n,i){var s=i===0?"discussion_id":"id";data={access_token:r},data[s]=e;var o=$.param(data);$.ajax({url:n+"?"+o,type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})}function a(e,r){return u(e,r,t.community_post_reply,n.community)}function f(e,r){return u(e,r,t.course_post_reply,n.course)}function l(e,t,n,i){var s=i===0?"discussion_id":"id";data={access_token:r},data[s]=e;var o=$.param(data);$.ajax({url:n+"?"+o,type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})}function c(e,r){return l(e,r,t.community_post,n.community)}function h(e,r){return l(e,r,t.course_post,n.course)}function p(e,t,n,i,s,o){var u=o===0?"discussion_id":"id";data={action:t,opinion:n,access_token:r},data[u]=e,$.ajax({url:s,data:data,type:"PUT",success:function(e){e.ok&&i&&i()},dataType:"json"})}function d(e,r,i,s){return p(e,r,i,s,t.community_post,n.community)}function v(e,r,i,s){return p(e,r,i,s,t.course_post,n.course)}var t={cmtCmt:"/apis/academy/"+channel+"review_reply.json",community_post_recommend:"/apis/academy/post_recommend.json",course_post_recommend:"/apis/academy/"+channel+"discussion_recommend.json",community_post_reply:"/apis/academy/post_reply.json",course_post_reply:"/apis/academy/"+channel+"discussion_reply.json",community_post:"/apis/academy/post.json",course_post:"/apis/academy/"+channel+"discussion.json"},n={course:0,community:1},r=e.getToken();return{editBlackboard:function(e,t){$.ajax({url:"/apis/academy/post_intro.json",data:{introduction:e,access_token:r},type:"PUT",success:function(e){e.ok&&t&&t()},dataType:"json"})},zanCommunityPost:s,zanCoursePost:o,deleteCommunityPost:c,deleteCoursePost:h,deleteCommunityPostCmt:a,deleteCoursePostCmt:f,doCommunityPost:d,doCoursePost:v,doPostClass:function(e,t,n){$.ajax({url:"/apis/academy/post_class.json",data:{class_id:t,post_id:e,access_token:r},type:"PUT",success:function(e){e.ok&&n&&n()},dataType:"json"})},getSimilarCourse:function(e,t){return e.length>100?!1:$.ajax({url:"/apis/academy/"+channel+"course_name.json",data:{name:e,limit:5,access_token:r},success:function(e){if(e.ok){var n=0,r=[];for(;n<e.result.length;n++)r.push({name:e.result[n].name,cname:e.result[n].cname,id:e.result[n].id});t(r)}},type:"get",dataType:"json",global:!1})},postCmtCmt:function(e,n,i){if(n.length>300){alert("评论字数不能超过300哦～");return}$.ajax({url:t.cmtCmt,data:{review_id:e,content:n,access_token:r},type:"POST",success:function(e){e.ok&&i&&i(e)},dataType:"json"})},getCmtCmt:function(e,n,i,s){$.ajax({url:t.cmtCmt+"?random="+Math.random(),data:{id:e,offset:n,limit:i,access_token:r},type:"GET",success:function(e){e.ok&&s&&s(e)},dataType:"json"})},delCmtCmt:function(e,n){var i=$.param({id:e,access_token:r});$.ajax({url:t.cmtCmt+"?"+i,type:"DELETE",success:function(e){e.ok&&n&&n(e)},dataType:"json"})}}}),!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("lib/wxApi",[],function(){return t(e)}):t(e,!0)}(window,function(e,t){function n(t,n,r){e.WeixinJSBridge?WeixinJSBridge.invoke(t,i(n),function(e){o(t,e,r)}):f(t,r)}function r(t,n,r){e.WeixinJSBridge?WeixinJSBridge.on(t,function(e){r&&r.trigger&&r.trigger(e),o(t,e,n)}):r?f(t,r):f(t,n)}function i(e){return e=e||{},e.appId=N.appId,e.verifyAppId=N.appId,e.verifySignType="sha1",e.verifyTimestamp=N.timestamp+"",e.verifyNonceStr=N.nonceStr,e.verifySignature=N.signature,e}function s(e){return{timeStamp:e.timestamp+"",nonceStr:e.nonceStr,"package":e.package,paySign:e.paySign,signType:e.signType||"SHA1"}}function o(e,t,n){var r,i,s;switch(delete t.err_code,delete t.err_desc,delete t.err_detail,r=t.errMsg,r||(r=t.err_msg,delete t.err_msg,r=u(e,r,n),t.errMsg=r),n=n||{},n._complete&&(n._complete(t),delete n._complete),r=t.errMsg||"",N.debug&&!n.isInnerInvoke&&alert(JSON.stringify(t)),i=r.indexOf(":"),s=r.substring(i+1)){case"ok":n.success&&n.success(t);break;case"cancel":n.cancel&&n.cancel(t);break;default:n.fail&&n.fail(t)}n.complete&&n.complete(t)}function u(e,t){var n,r,i,s;if(t){switch(n=t.indexOf(":"),e){case d.config:r="config";break;case d.openProductSpecificView:r="openProductSpecificView";break;default:r=t.substring(0,n),r=r.replace(/_/g," "),r=r.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}),r=r.substring(0,1).toLowerCase()+r.substring(1),r=r.replace(/ /g,""),-1!=r.indexOf("Wcpay")&&(r=r.replace("Wcpay","WCPay")),i=v[r],i&&(r=i)}s=t.substring(n+1),"confirm"==s&&(s="ok"),"failed"==s&&(s="fail"),-1!=s.indexOf("failed_")&&(s=s.substring(7)),-1!=s.indexOf("fail_")&&(s=s.substring(5)),s=s.replace(/_/g," "),s=s.toLowerCase(),("access denied"==s||"no permission to execute"==s)&&(s="permission denied"),"config"==r&&"function not exist"==s&&(s="ok"),t=r+":"+s}return t}function a(e){var t,n,r,i;if(e){for(t=0,n=e.length;n>t;++t)r=e[t],i=d[r],i&&(e[t]=i);return e}}function f(e,t){if(N.debug&&!t.isInnerInvoke){var n=v[e];n&&(e=n),t&&t._complete&&delete t._complete,console.log('"'+e+'",',t||"")}}function l(){if(!("6.0.2">S||T.systemType<0)){var e=new Image;T.appId=N.appId,T.initTime=x.initEndTime-x.initStartTime,T.preVerifyTime=x.preVerifyEndTime-x.preVerifyStartTime,L.getNetworkType({isInnerInvoke:!0,success:function(t){T.networkType=t.networkType;var n="https://open.weixin.qq.com/sdk/report?v="+T.version+"&o="+T.isPreVerifyOk+"&s="+T.systemType+"&c="+T.clientVersion+"&a="+T.appId+"&n="+T.networkType+"&i="+T.initTime+"&p="+T.preVerifyTime+"&u="+T.url;e.src=n}})}}function c(){return(new Date).getTime()}function h(t){b&&(e.WeixinJSBridge?t():m.addEventListener&&m.addEventListener("WeixinJSBridgeReady",t,!1))}function p(){L.invoke||(L.invoke=function(t,n,r){e.WeixinJSBridge&&WeixinJSBridge.invoke(t,i(n),r)},L.on=function(t,n){e.WeixinJSBridge&&WeixinJSBridge.on(t,n)})}var d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;if(!e.jWeixin)return d={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},v=function(){var e,t={};for(e in d)t[d[e]]=e;return t}(),m=e.document,g=m.title,y=navigator.userAgent.toLowerCase(),b=-1!=y.indexOf("micromessenger"),w=-1!=y.indexOf("android"),E=-1!=y.indexOf("iphone")||-1!=y.indexOf("ipad"),S=function(){var e=y.match(/micromessenger\/(\d+\.\d+\.\d+)/)||y.match(/micromessenger\/(\d+\.\d+)/);return e?e[1]:""}(),x={initStartTime:c(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},T={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",isPreVerifyOk:1,systemType:E?1:w?2:-1,clientVersion:S,url:encodeURIComponent(location.href)},N={},C={_completes:[]},k={state:0,res:{}},h(function(){x.initEndTime=c()}),L={config:function(e){N=e,f("config",e);var t=N.check===!1?!1:!0;h(function(){var e,r,i;if(t)n(d.config,{verifyJsApiList:a(N.jsApiList)},function(){C._complete=function(e){x.preVerifyEndTime=c(),k.state=1,k.res=e},C.success=function(){T.isPreVerifyOk=0},C.fail=function(e){C._fail?C._fail(e):k.state=-1};var e=C._completes;return e.push(function(){N.debug||l()}),C.complete=function(){for(var t=0,n=e.length;n>t;++t)e[t]();C._completes=[]},C}()),x.preVerifyStartTime=c();else{for(k.state=1,e=C._completes,r=0,i=e.length;i>r;++r)e[r]();C._completes=[]}}),N.beta&&p()},ready:function(e){0!=k.state?e():(C._completes.push(e),!b&&N.debug&&e())},error:function(e){"6.0.2">S||(-1==k.state?e(k.res):C._fail=e)},checkJsApi:function(e){var t=function(e){var t,n,r=e.checkResult;for(t in r)n=v[t],n&&(r[n]=r[t],delete r[t]);return e};n("checkJsApi",{jsApiList:a(e.jsApiList)},function(){return e._complete=function(e){if(w){var n=e.checkResult;n&&(e.checkResult=JSON.parse(n))}e=t(e)},e}())},onMenuShareTimeline:function(e){r(d.onMenuShareTimeline,{complete:function(){n("shareTimeline",{title:e.title||g,desc:e.title||g,img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareAppMessage:function(e){r(d.onMenuShareAppMessage,{complete:function(){n("sendAppMessage",{title:e.title||g,desc:e.desc||"",link:e.link||location.href,img_url:e.imgUrl,type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareQQ:function(e){r(d.onMenuShareQQ,{complete:function(){n("shareQQ",{title:e.title||g,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareWeibo:function(e){r(d.onMenuShareWeibo,{complete:function(){n("shareWeiboApp",{title:e.title||g,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},startRecord:function(e){n("startRecord",{},e)},stopRecord:function(e){n("stopRecord",{},e)},onVoiceRecordEnd:function(e){r("onVoiceRecordEnd",e)},playVoice:function(e){n("playVoice",{localId:e.localId},e)},pauseVoice:function(e){n("pauseVoice",{localId:e.localId},e)},stopVoice:function(e){n("stopVoice",{localId:e.localId},e)},onVoicePlayEnd:function(e){r("onVoicePlayEnd",e)},uploadVoice:function(e){n("uploadVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadVoice:function(e){n("downloadVoice",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},translateVoice:function(e){n("translateVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},chooseImage:function(e){n("chooseImage",{scene:"1|2",count:e.count||9,sizeType:e.sizeType||["original","compressed"]},function(){return e._complete=function(e){if(w){var t=e.localIds;t&&(e.localIds=JSON.parse(t))}},e}())},previewImage:function(e){n(d.previewImage,{current:e.current,urls:e.urls},e)},uploadImage:function(e){n("uploadImage",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadImage:function(e){n("downloadImage",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},getNetworkType:function(e){var t=function(e){var t,n,r,i=e.errMsg;if(e.errMsg="getNetworkType:ok",t=e.subtype,delete e.subtype,t)e.networkType=t;else switch(n=i.indexOf(":"),r=i.substring(n+1)){case"wifi":case"edge":case"wwan":e.networkType=r;break;default:e.errMsg="getNetworkType:fail"}return e};n("getNetworkType",{},function(){return e._complete=function(e){e=t(e)},e}())},openLocation:function(e){n("openLocation",{latitude:e.latitude,longitude:e.longitude,name:e.name||"",address:e.address||"",scale:e.scale||28,infoUrl:e.infoUrl||""},e)},getLocation:function(e){e=e||{},n(d.getLocation,{type:e.type||"wgs84"},function(){return e._complete=function(e){delete e.type},e}())},hideOptionMenu:function(e){n("hideOptionMenu",{},e)},showOptionMenu:function(e){n("showOptionMenu",{},e)},closeWindow:function(e){e=e||{},n("closeWindow",{immediate_close:e.immediateClose||0},e)},hideMenuItems:function(e){n("hideMenuItems",{menuList:e.menuList},e)},showMenuItems:function(e){n("showMenuItems",{menuList:e.menuList},e)},hideAllNonBaseMenuItem:function(e){n("hideAllNonBaseMenuItem",{},e)},showAllNonBaseMenuItem:function(e){n("showAllNonBaseMenuItem",{},e)},scanQRCode:function(e){e=e||{},n("scanQRCode",{needResult:e.needResult||0,scanType:e.scanType||["qrCode","barCode"]},function(){return e._complete=function(e){var t,n;E&&(t=e.resultStr,t&&(n=JSON.parse(t),e.resultStr=n&&n.scan_code&&n.scan_code.scan_result))},e}())},openProductSpecificView:function(e){n(d.openProductSpecificView,{pid:e.productId,view_type:e.viewType||0},e)},addCard:function(e){var t,r,i,s,o=e.cardList,u=[];for(t=0,r=o.length;r>t;++t)i=o[t],s={card_id:i.cardId,card_ext:i.cardExt},u.push(s);n(d.addCard,{card_list:u},function(){return e._complete=function(e){var t,n,r,i=e.card_list;if(i){for(i=JSON.parse(i),t=0,n=i.length;n>t;++t)r=i[t],r.cardId=r.card_id,r.cardExt=r.card_ext,r.isSuccess=r.is_succ?!0:!1,delete r.card_id,delete r.card_ext,delete r.is_succ;e.cardList=i,delete e.card_list}},e}())},chooseCard:function(e){n("chooseCard",{app_id:N.appId,location_id:e.shopId||"",sign_type:e.signType||"SHA1",card_id:e.cardId||"",card_type:e.cardType||"",card_sign:e.cardSign,time_stamp:e.timestamp+"",nonce_str:e.nonceStr},function(){return e._complete=function(e){e.cardList=e.choose_card_info,delete e.choose_card_info},e}())},openCard:function(e){var t,r,i,s,o=e.cardList,u=[];for(t=0,r=o.length;r>t;++t)i=o[t],s={card_id:i.cardId,code:i.code},u.push(s);n(d.openCard,{card_list:u},e)},chooseWXPay:function(e){n(d.chooseWXPay,s(e),e)}},t&&(e.wx=e.jWeixin=L),L}),define("lib/wxShare",["lib/wxApi"],function(e){return function(t,n){return e.config({debug:n?n:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:t.jsApiList}),{ready:function(t){e.ready(t)},error:function(t){e.error(t)},share:function(e){this.shareTimeline(e),this.shareAppMessage(e),this.shareQQ(e),this.shareWeibo(e)},shareTimeline:function(t){e.onMenuShareTimeline({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})},shareAppMessage:function(t){e.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})},shareQQ:function(t){e.onMenuShareQQ(t)},shareWeibo:function(t){e.onMenuShareWeibo(t)}}}}),define("lib/Draft",[],function(){"use strict";var e=function(){};return e.prototype={initDraft:function(e,t){function u(){if(r.text().trim().length<10)return localStorage.removeItem(i),!1;var e=r.clone();$(e).find("p blockquote").each(function(e,t){$(t).insertBefore($(t).parent())}),localStorage.setItem(i,e.html())}var n=e,r=n.contents().find("#tinymce"),i=t,s;if(!i)return!1;$("#draft").val(i);var o=localStorage.getItem(i);o&&r.html(o),r.focus(function(){s=setInterval(u,2e3)}),r.blur(function(){clearInterval(s)})},clearDraft:function(e){localStorage.removeItem(e)}},e}),require(["lib/m","lib/user","lib/bdShare","lib/screenTop","lib/scrollTo","lib/gbbcode","lib/at","academyApi","lib/accessToken","lib/wxShare","lib/Draft"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";function b(e,t){e.delegate("a[data-operation="+t+"]","click",function(e){e.preventDefault();var t=$(this);confirm("确定删除这条评论？")&&y.deleteComment(t.data("id"),function(){t.closest("li").fadeOut()})})}function w(e,t){if(t){var n=e.parent(),r=n.prev().prev().children(":not(blockquote)").text(),r=r.length>100?r.substring(0,100)+"...":r;t.selection.setContent(["<blockquote>引用@",n.siblings(".cmtAuthor").text()," 的话：",tinymce.html.Entities.encodeRaw(r),"</blockquote>"].join("")),i($(v)),t.focus()}else i($(v))}var c=article_id,h=$("#comments"),p="#replyForm",d="reply",v="#commentsReplyer",m=/@[\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9\._\-]+/g,g=a.getToken(),y={zanArticle:function(e,t,n){$.ajax({url:"/apis/academy/"+channel+"article_recommend.json",data:{id:e,opinion:t,access_token:g},type:"POST",success:function(e){e.ok&&n&&n()},dataType:"json"})},deleteArticle:function(e,t){var n=$.param({id:e,access_token:g});$.ajax({url:"/apis/academy/"+channel+"article_edit.json?"+n,type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})},deleteComment:function(e,t){var n=$.param({id:e,access_token:g});$.ajax({url:"/apis/academy/"+channel+"article_reply_edit.json?"+n,type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})}},E={login:function(e){function r(){var e=$("#captcha");if(r.sign===!0)return!1;r.sign=!0;var n=t.getContent(),i=n.trim().length,s,o;if(i===0)return alert("请填写内容"),r.sign=!1,!1;if(i>1e4)return alert("回应内容不能超过3000字"),r.sign=!1,!1;if(o&&o.length>20)return alert("对不起，不能@超过20个人"),r.sign=!1,!1;if(e.length&&e.attr("type")==="text"&&!e.val())return alert("验证码不能为空"),r.sign=!1,!1;s.insertAfter($(":submit",a))}function i(){if(tinyMCE.activeEditor){t=tinyMCE.activeEditor,draft_sign&&n.clearDraft(draft_sign),n.initDraft($("#reply_ifr"),e+"_note_"+c);return}setTimeout(i,100)}function s(){t&&t.initialized?h.delegate("a[data-operation=quoteCmt]","click",function(){w($(this),t)}):setTimeout(s,1e3)}var t,n=new l;$("#captchaImage").one("load",function(){function i(t){t.preventDefault(),e.attr("src",n+"?v="+r++)}var e=$("#captchaImage"),t=$("#changeCaptchaImage"),n=e.attr("src"),r=1;t.click(i),e.click(i)});var u=$("#"+d),a=$(p),f=$("#deleteArticle"),v=$("#contentDo"),m="赞",g="取消",E=0,S,x,T,N,C=function(e){if(e.type=="mouseenter"){clearTimeout(S);var t=$(this),n=t,r=n.find(".zanDo");S=setTimeout(function(){n.find(".zanList").show(),r.data("operation")=="support"&&n.find(".zanDo").addClass("zaned").find("span").removeClass("icon-zaned").addClass("icon-post_zaned")},100)}else if(e.type=="mouseleave"){clearTimeout(S);var t=$(this),n=t,r=n.find(".zanDo");S=setTimeout(function(){n.find(".zanList").hide(),r.data("operation")=="support"&&n.find(".zanDo").removeClass("zaned").find("span").removeClass("icon-post_zaned").addClass("icon-zaned")},100)}},k=function(e){var t=$(this),n=t.data("operation"),r=t.data("num");n=="support"&&E==0?(E=1,y.zanArticle(article_id,n,function(){r!="999+"?r++:"",t.data("operation","oppose").data("num",r),t.addClass("zaned"),t.find(".zanNum").html(r),t.children(":first").removeClass("icon-zaned").addClass("icon-post_zaned"),t.attr("title",g),E=0})):n=="oppose"&&E==0&&(E=1,y.zanArticle(article_id,n,function(){r!="999+"?r--:"",t.data("operation","support").data("num",r),t.removeClass("zaned"),t.find(".zanNum").html(r),t.children(":first").addClass("icon-zaned").removeClass("icon-post_zaned"),t.attr("title",m),E=0}))};v.delegate(".zanDo","click",k),v.delegate("#zan","mouseenter mouseleave",C),f.click(function(){confirm("确定删除此篇文章？")&&y.deleteArticle(article_id,function(){window.location.href=course_url})}),b(h,"deleteCmt"),$(function(){window.initEditor("#reply",{content_css:tinymceContentCSS,width:595,scroll_top_offset:0,autoscroll:!0,submit_form_selector:"#replyForm",toolbar:"bold italic | link gkimage video blockquote | bullist numlist  formula | fullscreen",atFunc:o})}),i(),s(),$("#replyForm").submit(r),$(".cmts-list li").hover(function(){$(this).find(".cmtDo").toggle()})},all:function(){function l(t,r,i,s){var o={url:location.protocol+"//"+location.host+location.pathname+"?f=wx",pic:i};n(t,r),t.addClass("bdsharebuttonbox"),t.attr("data-tag","shareMain"),window._bd_share_config={share:{tag:"shareMain",bdUrl:o.url,bdPic:o.pic,bdSign:"off",onBeforeClick:function(e,t){return e==="tsina"?t.bdText="这个长姿势 →_→【"+s+"】#MOOC学院#（分享自 @MOOC学院）":e==="tqq"?t.bdText="这个长姿势 →_→【"+s+"】#MOOC学院#（来自 MOOC学院）":t.bdDesc="这个长姿势 →_→【"+s+"】#MOOC学院#（来自 MOOC学院）",t},bdSnsKey:{tsina:"2727579136",tqq:"100246400"}}},e.loadScript("http://static.guokr.com/baidu-share/static/api/js/share.js?v=226108fe.js?cdnversion="+~(-(new Date)/36e5))}$(".content-txt a").attr("target","_blank"),$("#comments .cmt-content a").attr("target","_blank"),r();var t=f({appId:wxConfig.appid,timestamp:wxConfig.timestamp,nonceStr:wxConfig.nonceStr,signature:wxConfig.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]},!1);t.ready(function(){t.share({title:document.title,desc:$.trim($("#contentTxt").text()),link:location.protocol+"//"+location.host+location.pathname,imgUrl:$(".side-course img").attr("src"),success:function(){},cancel:function(){}})});var i=$("#share"),o='<div class="share-btn share-btn-desktop">分享</div>                        <div class="share-btn shareBtn share-btn-mobile"><i href="#" class="share-icon">分享</i>分享</div>                        <div class="share-btns shareBtns">                            <div class="share-btn-inner">                                <a data-cmd="tsina" class="share-sina" href="#" title="分享到新浪微博">新浪微博</a>                                <a data-cmd="douban" class="share-db" href="#" title="分享到豆瓣">豆瓣</a>                                <a data-cmd="qzone" class="share-qzone" href="#" title="分享到QQ空间">QQ空间</a>                                <a data-cmd="weixin" class="share-wx" href="#" title="分享到微信">微信</a>                                <a data-cmd="tqq" class="share-qqmb" href="#" title="分享到腾讯微博">腾讯微博</a>                            </div>                        </div>',u=$("#contentTitle").text()||document.title,a=$("#sharePic").attr("src")||$("#contentTxt img:eq(0)").attr("src")||"";l(i,o,a,u),$(".shareBtn").on("click",function(e){e.preventDefault();var t=$(".shareBtns");t.is(":hidden")?t.slideDown("100"):t.slideUp("100",function(){var e=$(this);e.css({display:"",width:""})})}),s()},unlogin:function(){$("#comments").delegate(".cmt-do-quote","click",function(){i($("#commentsReplyer"))}),$(".main").delegate("#zan, #commentsReplyer .to-login a","click",function(e){e.preventDefault();var n=document.body.clientWidth<768?url_signin_mobile:url_signin;t.toLogin(n)})}},S=t.isLogin()?"login":"unlogin";E[S]&&E[S](ukey),E.all&&E.all()}),define("note",function(){})})();