(function(){define("lib/ga",[],function(){window._bdhmProtocol="https:"==document.location.protocol?"https://":"http://",window._gaq=window._gaq||[],_gaq.push(["_setAccount","UA-19521615-1"]),window.ukey?(_gaq.push(["_setCustomVar",1,"Is Registered","Yes",1]),_gaq.push(["_setCustomVar",2,"Is Signed In","Yes",3])):(_gaq.push(function(){var e=_gat._getTrackerByName(),t=e._getVisitorCustomVar(1);t!=="Yes"&&t!=="No"&&_gaq.push(["_setCustomVar",1,"Is Registered","No",1])}),_gaq.push(["_setCustomVar",2,"Is Signed In","No",3])),_gaq.push(["_trackPageview"]),_gaq.push(["_trackPageLoadTime"]);var e="text/javascript",t=!0,n=document.getElementsByTagName("script")[0],r=document.createElement("script"),i=document.createElement("script");r.type=e,r.async=t,r.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",i.type=e,i.async=t,i.src=_bdhmProtocol+"hm.baidu.com/h.js?95dfd07652f91dffd9647f46a3ca9fab",n.parentNode.insertBefore(r,n)}),define("lib/cookies",{get:function(e){"use strict";if(document.cookie.length>0){var t,n=document.cookie.indexOf(e+"=");if(n!=-1)return n=n+e.length+1,t=document.cookie.indexOf(";",n),t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))}return""},set:function(e,t,n,r){"use strict";return document.cookie=e+"="+escape(t)+(n==null?"":";expires="+n.toGMTString())+";path="+(r||"/"),this},remove:function(e,t){"use strict";var n=new Date;n.setTime(n.getTime()-1);var r=this.get(e);r!=null&&(document.cookie=e+"="+r+";expires="+n.toGMTString()+";path="+(t||"/"))}}),define("lib/m",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document;return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isSF:/a/.__proto__=="//",isCR:/s/.test(/a/.toString)},scriptOnload:function(e,t){this.ua.isIE?e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()}):(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1))},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})}}}),define("lib/support",["lib/m"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Overlay",["lib/support","lib/Event","lib/m"],function(e,t,n){"use strict";function y(e){var t,n;e?(t=(u.height()-h.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),n=(u.width()-h.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(t=(u.height()-h.height())/2,n=(u.width()-h.width())/2),h.css({top:t,left:n})}function b(e,t){v&&v.length&&v.css({opacity:e||.5,"background-color":t||"#000"}).show()}function w(){v&&v.length&&v.remove()}function E(){v.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function S(){v.css({width:u.width(),height:u.height()})}function x(t){i=t,s='<div id="blockWindow" class="'+i+'-block">                           <div class="'+i+'-block-b">                               <h4 class="'+i+'-block-hd">                                   <span id="blockTitle"></span>                                   <a id="blockClose" class="block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+i+'-block-bd"></div>                           </div>                       </div>',h=$(s),h.appendTo("body"),p=$(a),d=$(f),g=[h,p],navigator.userAgent.match(/iPad|iPhone/i)!==null?c=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(c=e.fixed(),u.resize(function(){m&&m.pos()})),h.delegate(l,"click",function(e){e.preventDefault(),m&&m.close()})}function T(e,t,n,r){this._isOpen=!1,x.call(this,r),this._fixed=c,e&&!r&&this.open(e,t,n)}var r=0,i,s,o='<iframe src="{v}" id="blockIframe" class="block-iframe" frameborder="0" width="100%"></iframe>',u=$(window),a="#blockContent",f="#blockTitle",l="#blockClose",c,h,p,d,v,m,g;return T.prototype={openCallBack:function(e){return e&&this.on("open",e,this),this},closeCallBack:function(e){return e&&this.on("close",e,this),this},afterClose:function(e){return e&&this.on("afterClose",e,this),this},afterOpen:function(e){return e&&this.on("afterOpen",e,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",g)?(h.remove(),this._isOpen=!1,m=null,this.fire("afterClose",g),this):this:this},open:function(e,t,r){return this.fire("open",g)?(m&&m!==this&&m.close(),m=this,this.undelegate(),t&&this.delegate(t),e&&!n.isHtml(e)&&(e=n.format(o,e)),p.html(e||""),this._title&&d.html(this._title),this._width&&h.width(this._width),this._height&&h.height(this._height),h.css("position",!this._fixed||!c?"absolute":"fixed"),this.pos(),h.show(),this._isOpen=!0,r&&r.call(this,p),this.fire("afterOpen",g),this):this},delegate:function(e){if(!e.length){p.delegate(e.selector,e.event,e.func);return}return n.each(e,function(e){this.delegate(e.selector,e.event,e.func)},p),this},undelegate:function(){return p.undelegate(),this},pos:function(){return y(!this._fixed||!c),this},title:function(e){return this._title=e,this._isOpen&&d.html(e),this},width:function(e){return this._width=e,this._isOpen&&(h.width(e),this.pos()),this},height:function(e){return this._height=e,this._isOpen&&(h.height(e),this.pos()),this},pin:function(){if(this._fixed||!c)return;return this._fixed=!0,this._isOpen&&(h.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(h.css("position","absolute"),this.pos()),this},showCover:function(e,t){v=$('<div id="blockCover" style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(h.css("z-index"),10)||0)-1)+';"></div>').appendTo("body");var n=this;return this.on("afterClose",function(){w()}).on("afterOpen",function(){b(n._coverOpacity,n._coverColor)}),typeof e=="string"&&(t=e,e=null),e&&(this._coverOpacity=e),t&&(this._coverColor=t),b(e||this._coverOpacity,t||this._coverColor),this},hideCover:function(){return w(),this}},t.extend(T),T}),+function(e){"use strict";var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var t=e.Event("show.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])},t.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var t=e.Event("hide.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350)},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n);i||r.data("bs.collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":n.data(),a=n.attr("data-parent"),f=a&&e(a);if(!o||!o.transitioning)f&&f.find('[data-toggle=collapse][data-parent="'+a+'"]').not(n).addClass("collapsed"),n[s.hasClass("in")?"addClass":"removeClass"]("collapsed");s.collapse(u)})}(jQuery),define("lib/collapse",function(){}),define("lib/JSON2",function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}window.JSON||(window.JSON={}),typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),define("lib/JSON2",function(){}),define("lib/store",["lib/JSON2"],function(){function e(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),"localStorage"in window}catch(n){return!1}}var t=e(),n={set:function(){},get:function(){},remove:function(){},clear:function(){},isSupport:!1};if(t){var r=window.localStorage,i=function(e,t){var n=r[e];return function(i){setTimeout(function(){i=i||window.storageEvent;var s=i.key,o=i.newValue;if(!s){var u=r[e];u!=n&&(s=e,o=u)}s==e&&(t&&t(o==null?null:JSON.parse(o)),n=o)},0)}};n.set=function(e,t){r.setItem(e,JSON.stringify(t))},n.get=function(e){var t=r.getItem(e),i=t==null?null:JSON.parse(t);return i!==null&&i.date&&i.expiredDate&&n._expired(e,i.expiredDate,i.date)&&(i=null),i},n.remove=function(e){r.removeItem(e)},n.clear=function(){r.clear()},n.onStorage=function(e,t){window.addEventListener?window.addEventListener("storage",i(e,t),!1):document.attachEvent("storage",i(e,t))},n._expired=function(e,t,r){return(new Date).getTime()-r>=t*864e5?(n.remove(e),!0):!1},n.isSupport=!0}else/MSIE ([^;]+)/.test(navigator.userAgent)&&(n={o:null,defExps:365,init:function(){if(!n.o)try{n.o=document.createElement("input"),n.o.type="hidden",n.o.addBehavior("#default#userData"),document.body.appendChild(n.o)}catch(e){return!1}return!0},set:function(e,t,r){if(n.init()){var i=n.o;i.load(e),t&&i.setAttribute("code",JSON.stringify(t));var s=new Date,r=r?r:n.defExps;s.setDate(s.getDate()+r),i.expires=s.toUTCString(),i.save(e)}},get:function(e){if(n.init()){var t=n.o;return t.load(e),typeof t.getAttribute("code")=="undefined"?null:JSON.parse(t.getAttribute("code"))}},onStorage:function(){},remove:function(e){n.set(e,!1,-365)},isSupport:!0});return n}),define("lib/user",["lib/store"],function(e){function n(n,i){if(!window.ukey)return n(null);var s=r();!s||window.ukey!=s.ukey?$.getJSON("/_csi/user/info.json").done(function(r){r.ok&&(e.isSupport&&e.set(t,r.result),n(r.result))}).fail(function(){i&i()}):n(s)}function r(){e.get(t)}function i(){e.remove(t)}var t="CURRENT_USER_CACHE_KEY";return{getCurrent:n,getUserCache:r,clearUserCache:i,isLogin:function(){return typeof ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),define("lib/beforeLogin",["lib/tmpl"],function(e){"use strict";function n(n){if(t)return;var i="注册MOOC学院，关注收藏值得上的好课！",s=n||1e3,o='<div class="beforeLogin">                            <div class="beforeLogin-main">                                <div class="slogn"><%= layer %></div>                                <a class="beforeLogin-sina" href="<%= weibo %>" target="_blank" data-gaevent="footer_sina_login:v3.0.0.0:academy"></a>                                <a class="beforeLogin-qq" href="<%= qq %>" target="_blank" data-gaevent="footer_qq_login:v3.0.0.0:academy"></a>                                <a class="beforeLogin-douban" href="<%= douban %>" target="_blank" data-gaevent="footer_douban_login:v3.0.0.0:academy"></a>                                <a class="beforeLogin-login" href="<%= login %>" data-gaevent="footer_login:v3.0.0.0:academy">登录</a>                                <span>或直接</span>                                <a class="beforeLogin-signup" href="<%= signup %>" data-gaevent="footer_signup:v3.0.0.0:academy">注册MOOC学院</a>                            </div>                            <a class="beforeLogin-close" href="javascript:void(0)" title="关闭">X</a>                        </div>',u=e(o,{layer:i,weibo:weibo_signin,qq:qq_signin,douban:douban_signin,signup:url_signup,login:url_signin});$("body").append($(u)),$(".beforeLogin-close").click(function(){r(s)}),$(".beforeLogin").fadeIn(s),t=!0}function r(e){if(!t)return;var n=e||1e3;$(".beforeLogin").fadeOut(n)}var t=!1;return function(e,t){var i=t||1e3,s=e||2e3,o=!1;return $(window).one("scroll",function(){n(i)}),setTimeout(function(){n(i)},e),{delLayer:r}}}),define("lib/OneTask",["lib/store","lib/JSON2","lib/cookies","lib/Event"],function(e,t,n,r){"use strict";function a(e,n,r){function s(){i._run()}this.name="T"+e,this.serverTimeKey=this.name+"T",this.jobMsgKey=this.name+"M",this.asyncJob=n,this.jobMsg=null,this.isServer=!1,this.params=r&&r.params,this.serverTimeout=r&&r.serverTimeout||2e3,this.intervalTime=r&&r.interval||3e4,this.timeUpdateInterval=0,this.jobRunInterval=0,this.serverCheckInterval=0,this.isRunning=!1,this.inited=!1;var i=this;i.callback=function(e,n){i.fire("callback",n?e:t.parse(e)),i.jobRunInterval=setTimeout(s,i.intervalTime)}}var t=window.JSON,i=location.pathname+"?"+(new Date).getTime()+Math.random(),s=e.isSupport?e.set:function(e,r){n.set(e,t.stringify(r))},o=e.isSupport?e.get:function(e){var r=n.get(e);return r?t.parse(r):null},u=e.isSupport?e.remove:function(e){n.remove(e)};return r.extend(a),a.prototype._run=function(){var e=this;if(!e.isRunning)return this;if(e.isServer){var n=function(n){if(e.isServer){var r=t.stringify(n);s(e.jobMsgKey,r),e.jobMsg!==r&&(e.fire("changeCallBack",n),e.jobMsg=r),e.callback(n,!0)}else e.callback(e.jobMsg)};this.params?e.asyncJob.apply(e,[n].concat(this.params)):e.asyncJob.call(e,n)}else e.callback(e.jobMsg);return this},a.prototype.start=function(){var n=this;return n.isRunning?this:(n.isRunning=!0,n.switchToServer(),e.isSupport&&!n.inited&&e.onStorage(n.jobMsgKey,function(e){n.isRunning&&n.jobMsg!==e&&(n.jobMsg=e,n.fire("changeCallBack",t.parse(e)))}),n.serverCheckInterval=setInterval(function(){n.check();if(n.isServer)return;var r=parseInt(o(n.serverTimeKey),10)||0,i=(new Date).getTime();(!r||i-r>n.serverTimeout)&&n.switchToServer();if(!e.isSupport&&n.isRunning){var s=o(n.jobMsgKey);n.jobMsg!==s&&(n.jobMsg=s,n.fire("changeCallBack",t.parse(s)))}},this.serverTimeout/2),n._run(),n.inited=!0,this)},a.prototype.stop=function(){var e=this;return e.isRunning=!1,e.switchToClient(),clearInterval(e.serverCheckInterval),this},a.prototype.cancel=function(){return this.isServer&&(u(this.name),u(this.serverTimeKey),u(this.jobMsgKey)),clearInterval(this.timeUpdateInterval),clearTimeout(this.jobRunInterval),clearInterval(this.serverCheckInterval),this},a.prototype.check=function(e){var t=this;return e=e||o(t.name),e?e!==i?t.isServer=!1:t.isServer=!0:t.switchToServer(),this},a.prototype.switchToServer=function(){var e=this;return e.isServer?this:(e.isServer=!0,s(e.name,i),s(e.serverTimeKey,(new Date).getTime()),e.timeUpdateInterval=setInterval(function(){o(e.name)!==i?clearInterval(e.timeUpdateInterval):s(e.serverTimeKey,(new Date).getTime())},e.serverTimeout/2),this)},a.prototype.switchToClient=function(){var e=this;return e.isServer?(e.isServer=!1,u(e.name),u(e.serverTimeKey),clearInterval(e.timeUpdateInterval),this):this},a.prototype.useCookie=!e.isSupport,a.prototype.onChangeCallBack=function(e){return this.on("changeCallBack",e,this),this},a.prototype.onCallBack=function(e){return this.on("callback",e,this),this},a}),define("lib/accessToken",["lib/cookies"],function(e){"use strict";var t,n=window.location.host,r=window.url_re_signin||"",i=window.client_id||32353;return t=e.get("_"+i+"_access_token"),{checkToken:function(){return typeof t=="string"?!0:!1},getToken:function(){return t}}}),define("lib/NotifyUtil",["lib/OneTask","lib/Event","lib/JSON2","lib/accessToken"],function(e,t,n,r){function u(){this.on("update",function(e,t,n){s=t==null?s:t,localRemindCount=e==null?localRemindCount:e})}var i=3e4,s=-1;localRemindCount=-1;var o={getNotifyInfo:function(e,t){var n=r.getToken();$.ajax({url:"/apis/community/notice/count.json?retrieve_type=by_client_id&access_token="+n,type:"get",dataType:"json",success:e,cache:!1})},getNotifyList:function(e){var t=r.getToken();$.ajax({url:"/apis/community/notice.json?retrieve_type=by_client_id&access_token="+t,type:"get",dataType:"json",success:e,cache:!1})},deleteNotify:function(e,t,n,i){var s=r.getToken();$.ajax({url:"/apis/community/notice_ignore.json",data:{nid:e,access_token:s},type:"put",dataType:"json",success:n,error:i})}};u.prototype={deleteNotify:function(e,t,n){var r=this;o.deleteNotify(e,"",function(e){e=e.result,r.fire("update",null,e.count,e.list,null,e.all),t&&t()},n)},deleteAllNotify:function(e,t){o.deleteNotify("","all",function(){localRemindCount=0,s=0,e&&e()},t)},getNotifyList:function(e,t){o.getNotifyList(e,t)},onUpdate:function(e){this.on("update",e)}},t.extend(u);var a=new u,f;return ukey&&(f=new e("N",function(e){o.getNotifyInfo(function(t){e(t.result)})},{interval:i}),f.onChangeCallBack(function(e){var t=e.unread_count,n=localRemindCount;e!=null&&(t!==s||n!==localRemindCount)&&(t?a.getNotifyList(function(e){a.fire("update",n,t,e.result)}):a.fire("update",n,t))}).start(),f.useCookie&&$(window).unload(function(){f.cancel()})),a}),define("lib/notify",["lib/cookies","lib/NotifyUtil","lib/tmpl"],function(e,t,n){"use strict";function u(){function n(){t.deleteAllNotify(function(){e.dismissIds=[],e.$noticeBottom.length||e.$noticeTitle.html("通知"),e.noticeNum=0,e.$noticeBlock.fadeOut("slow",function(){e.$noticeDiv.removeClass(i),e.hide(),e.$noticeNum.text(0)})})}function s(n){if($.inArray(n,e.dismissIds)!==-1)return;e.dismissIds.push(n),e.dismissIds.length===1&&t.deleteNotify(e.dismissIds[0],function(){var t=e.$noticeBlock.find("li[data-id="+e.dismissIds[0]+"]");e.$noticeNum.text(e.noticeNum>99?"99":e.noticeNum),e.noticeNum?e.$noticeDiv.addClass(i):e.$noticeDiv.removeClass(i),e.dismissIds.shift(),e.dismissIds.length&&s(e.dismissIds[0]),e.noticeNum===0&&(e.$noticeDiv.removeClass(i),e.hide())},function(){setTimeout(function(){s(e.dismissIds[0])},3e4)})}var e=this;this.noticeList=[],this.noticeNum=0,this.$noticeBottom=$("#noticeBottom"),this.$noticeDiv=$("#navbarNotice"),this.$noticeBlock=$("#noticeBlock"),this.$noticeNum=$("#noticeNum"),this.$noticeTitle=this.$noticeDiv.children().eq(0),this.$settingsDiv=$("#navbarSettings"),this.$settingsBlock=$("#settingsBlock"),this.$settingsTitle=this.$settingsDiv.children().eq(0),this.dismissIds=[];if(!this.$noticeDiv.length||!this.$noticeBlock.length)return;this.$noticeBlock.delegate("[data-operation=openLink]","mouseup",function(t){if(t.which!==1&&t.which!==2)return;var n=$(this).closest("li"),r=n.data("id");n.siblings().length?(e.noticeNum--,e.$noticeNum.text(e.noticeNum>99?"99":e.noticeNum),e.noticeNum?e.$noticeDiv.addClass(i):e.$noticeDiv.removeClass(i),n.fadeOut("slow",function(){n.remove()})):(e.$noticeBottom.length||e.$noticeTitle.html("通知"),e.$noticeDiv.removeClass(i),e.$noticeBlock.fadeOut("slow",function(){e.hide()})),s(r)}),this.$noticeBlock.delegate("[data-operation=dismissOne]","click",function(){var e=$(this).closest("li").css("opacity",.5).data("id");s(e)}),this.$noticeBlock.delegate("[data-operation=dismissAll]","click",n),$("body").bind("click",function(t){!$.contains(e.$noticeDiv[0],t.target)&&$(t.target).data("operation")!=="dismissOne"&&e.hide(),$.contains(e.$settingsDiv[0],t.target)||e.hideCertain("settings")}),this.$noticeTitle.click(function(){if(document.body.clientWidth<768){var t=$(this).data("url");location.href=t}else e._isClosed?e.show():e.hide()}),this.$settingsTitle.click(function(){e.$settingsBlock.toggle().parent().toggleClass(r)}),t.onUpdate(function(t,n,r){e.update(t,n,r),e._notify()})}var r="actived",i="unread",s=window.location.host,o='<li data-id="<%=id%>">                                <p><a href="<%=url%>" data-operation="openLink" target="_blank"><%=content%></a></p>                                <a href="javascript: void 0;" class="icon-close" data-operation="dismissOne">x</a>                            </li>';return u.prototype={_isClosed:!0,_init:function(){var t=this,n="isN",r=e.get(n);if(!r){var i=new Date;i.getHours()>4&&i.setDate(i.getDate()+1),i.setHours(4,0,0,0),e.set(n,1,i),t.noticeNum?t.show():t._notify()}else t._notify()},_notify:function(){var e=this;return e.$noticeNum.text(e.noticeNum>99?"99":e.noticeNum),e.noticeNum?e.$noticeDiv.addClass(i):e.$noticeDiv.removeClass(i),e.$noticeBlock.find("ul").html(e.noticeNum?e.noticeList.join(""):""),this},update:function(e,t,r){return this.noticeList=r||[],this.noticeList.length>5&&(this.noticeList=this.noticeList.slice(0,5)),this.noticeList=$.map(this.noticeList,function(e){return n(o,e)}),this.noticeNum=t||0,this.noticeNum===0&&(this.noticeList=[],this.hide()),this._init(),this._notify(),this},hide:function(){return this.$noticeBlock.hide(),this.$noticeDiv.removeClass(r),this._isClosed=!0,this},hideCertain:function(e){return this["$"+e+"Block"].hide(),this["$"+e+"Div"].removeClass(r),this},show:function(){var e=this;return e._notify(),e.$noticeDiv.addClass(r),e.$noticeBlock.show(),e._isClosed=!1,this}},function(){return new u}}),define("lib/template",["lib/tmpl"],function(e){return function(t){function i(){return r.templateSource?$.get(r.templateSource,r.data):r.template}function s(){return r.dataSource!=undefined&&(r.dataSource+="&random="+Math.random()),r.dataSource?$.getJSON(r.dataSource,r.data):{}}var n={data:{},dataSource:undefined,template:undefined,templateSource:undefined,callback:function(){}},r=$.extend({},n,t);$.when(i(),s()).done(function(t,n){typeof t=="object"?template=t[0]:template=t,n[0]!=undefined?data=$.extend(!0,{},r.data,n[0]):data=$.extend(!0,{},r.data,n);if(data.result instanceof Array){var i=e(template);for(var s in data.result)r.callback(i(data.result[s]))}else r.callback(e(template,data))})}}),define("lib/csi",["lib/template"],function(e){function r(r,i){var s=$.extend(!0,{},n,r);$(s.templateSelector).filter(function(e){if(this.hasAttribute(s.filterKeys)){var n=this.getAttribute(s.filterKeys).split(t),r,i,o;for(var r in n){i=n[r].split(".");if(i[0]=="")continue;o=i.length==2&&s.filters[i[0]]&&s.filters[i[0]][i[1]];if(!o)return!1}}return!0}).each(function(t,n){e({data:s.global,dataSource:n.getAttribute(s.dataSourceKey),template:n.innerHTML,templateSource:n.getAttribute(s.templateSourceKey),callback:function(e){var t=n.getAttribute(s.renderToKey),r=n.getAttribute(s.successKey),o;t?t.indexOf("#")==0?o=$(n.getAttribute(s.renderToKey)):o=$("["+s.idKey+'="'+t+'"]'):o=$(n),o.length>1?o.each(function(t,n){var r=new RegExp(s.indexKey+'="'+$(this).attr(s.indexKey)+'"');r.test(e)?n.outerHTML=e:""}):o.each(function(t,n){n.outerHTML=e}),r&&i!=undefined&&i()}})})}var t=";",n={templateSelector:"[data-csi]",templateSourceKey:"data-csi-src",dataSourceKey:"data-csi-source",renderToKey:"data-csi",idKey:"data-csi-id",indexKey:"data-csi-index",filterKeys:"data-csi-filters",successKey:"data-csi-success",filters:{},global:{}};return r}),require(["lib/ga","lib/cookies","lib/Overlay","lib/collapse","lib/user","lib/beforeLogin","lib/notify","lib/csi"],function(e,t,n,r,i,s,o,u){"use strict";function a(){if(window.ukey)return;var e=document.cookie.match(/_ukey=([\d\w]{6})/),t=document.cookie.match("_"+window.client_id+"_auto_signin");!e&&t?$('.navbar-login a[data-operation="login"]')[0].click():e&&(window.ukey=e[1])}function p(){var e=window.location.hash;if(e){var t=$(e);setTimeout(function(){$("html, body").animate({scrollTop:t.offset().top},1e3)},1e3)}}a();var f=["indexPage","welcomePage","welcome2Page"];ukey?i.getCurrent(function(e){u({filters:{csi:{logined:!0},feeds:{all:!0}},global:{user:e}},function(){o()})}):(u({filters:{csi:{unlogined:!0},feeds:{all:!0}}}),$.inArray(g_page_name,f)===-1&&document.body.clientWidth>768&&s()),$("body").delegate("a[data-analyze]","click",function(){t.set("gkanalyze",$(this).data("analyze"))}),$("body").delegate("a[data-gaevent]","click",function(){var e=$(this).data("gaevent").split(":");_gaq.push(["_trackEvent",e[0],$(this).attr("href"),e[e.length-1]])});var l=$("#feedback"),c=l.text().replace(/\[at\]/,"@").replace(/\[dot\]/,".");l.text(c).attr("href","mailto:"+c);if(document.body.clientWidth<768){var h=$("#navbarForm");$("body").bind("click",function(e){$.contains(document.getElementById("navbar"),e.target)||h.slideUp()}),$("#mSearch").click(function(){h.slideDown()})}$("#unlogined").delegate('a[data-operation="login"]',"click",function(e){e.preventDefault();var t=typeof url_signin_mobile!="undefined"&&document.body.clientWidth<768?url_signin_mobile:url_signin;i.toLogin(t)}),$(p)}),define("main",function(){})})();